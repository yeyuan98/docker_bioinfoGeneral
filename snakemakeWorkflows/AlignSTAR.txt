---------------
STAR alignment with trimming

Ye Yuan
Apr 19, 2025

Workflow: trim_galore -> STAR | samtools, with fastqc pre- and post-trimming

---------------
Config: *AlignSTAR.yaml* in current working dir. To generate a template, run the smkConfig.sh helper.

Input: *rawdata* folder containing gzipped FASTQ files as input. Single-end must be {sample}.fastq.gz while paired-end must be {sample}_1.fastq.gz and {sample}_2.fastq.gz.

Input: STAR genome index folder path defined in the config file. This folder is passed to STAR argument `--genomeDir`.

Output: *trimmed* folder containing gzipped trimmed FASTQ files. Trimming is performed with trim_galore with parameters specified in config. Trimming reports generated by trim_galore is also stored here (one file per sample).

Output: *alignment* folder containing STAR alignment files. STAR raw output sorted BAM file is indexed by samtools. Also stores geneCount table outputs of STAR for differential gene expression analysis.

Output: *fastqc* folder containing fastQC reports. Two folders per sample: one for pre-trimming FASTQ and one for post-trimming FASTQ. To run fastqc, you need to force run rules by `-R fastqc`.

Logging: stderr messages for all workflow steps are stored here, following general naming convention "<STEP>_<SAMPLE>.log".

Index building: call STAR to build the genome index if needed. An example command is `STAR --genomeDir genome_index_STAR --genomeFastaFiles dm6/dm6.fa --runThreadN 8 --runMode genomeGenerate --sjdbGTFfile dm6/dm6.refGene.gtf`.

Temporary folder issue: STAR stores intermediate results using FIFO file. This means that the temporary folder (see config:star:temp_root) must be in a Linux/MacOS filesystem. If you are using FAT/NTFS drive, the temporary folder must point to a Linux/MacOS drive. In this case, you may use the default "/home/temp", which points to a container temporary layer.